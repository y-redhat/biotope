<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>NovaNotions ‚Äì Ideology Biotope</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<style>
body{margin:0;background:#000;font-family:monospace;overflow:hidden}
#ui{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);
width:90%;text-align:center;z-index:10}
input{width:60%;padding:10px;background:rgba(0,0,0,.8);
border:1px solid #0f0;color:#0f0}
#stats{color:#aaa;font-size:12px;margin-bottom:4px}
#log{position:absolute;top:10px;left:10px;width:420px;height:260px;
overflow:auto;font-size:11px;color:#0f0;
background:rgba(0,0,0,.6);border:1px solid #033;padding:5px}
</style>
</head>

<body>
<div id="log"></div>
<div id="ui">
<div id="stats">
YEAR:<span id="year">0</span> |
POP:<span id="pop">0</span> |
CIV:<span id="civ">Hunter-Gatherer</span> |
WAR:<span id="warstat">NO</span>
</div>
<input id="cmd" placeholder="> genesis / war / reset">
</div>

<script>
let organisms=[],foods=[];
let time=0,epoch=0,war=false,civilization=0;
const CIV_NAMES=["Hunter-Gatherer","Agriculture","Nation"];
let cmd,logDiv,logBuffer=[];
let border=0.5;

function setup(){
 createCanvas(windowWidth,windowHeight);
 cmd=document.getElementById("cmd");
 logDiv=document.getElementById("log");
 spawnFood(260);
 runCommand("genesis");

 cmd.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
   runCommand(cmd.value);
   cmd.value="";
  }
 });
}

function draw(){
 background(0);
 time++; if(time%60===0) epoch++;

 if(organisms.length>40&&civilization===0) civilization=1;
 if(organisms.length>120&&civilization===1) civilization=2;

 drawNations();
 updateUI();
 drawFood();
 updateOrganisms();

 if(war) checkSurrender();

 if(frameCount%20===0)
  logDiv.innerHTML=logBuffer.slice().reverse().join("<br>");
}

function drawNations(){
 if(!war){
  noStroke();
  fill(120,0,0,40);
  rect(0,0,width*border,height);
  fill(0,0,120,40);
  rect(width*border,0,width,height);
  stroke(200);
  strokeWeight(civilization===2?3:1);
  line(width*border,0,width*border,height);
 }
}

function updateUI(){
 year.innerText=epoch;
 pop.innerText=organisms.length;
 civ.innerText=CIV_NAMES[civilization];
 warstat.innerText=war?"YES":"NO";
}

class Organism{
 constructor(){
  this.ideology=random()<0.5?"red":"blue";
  this.pos=createVector(
   this.ideology==="red"
    ?random(width*0.05,width*border-10)
    :random(width*border+10,width*0.95),
   random(height)
  );
  this.vel=p5.Vector.random2D().mult(0.6);
  this.size=random(8,14);
  this.health=1;
 }

 update(){
  this.health -= 1/(60*60); // ‚òÖ Á¥Ñ1ÂàÜÂØøÂëΩ

  this.pos.add(this.vel);
  if(random()<0.02)
   this.vel=p5.Vector.random2D().mult(0.6);

  // È£üÊñô
  for(let f of foods){
   if(dist(this.pos.x,this.pos.y,f.pos.x,f.pos.y)<this.size){
    this.health=min(1,this.health+0.25);
   }
  }

  // ÁπÅÊÆñÔºàËæ≤Ê•≠‰ª•ÈôçÔºâ
  if(civilization>=1 && this.health>0.9 && random()<0.002){
   organisms.push(new Organism());
   this.health*=0.5;
  }

  // ÂõΩÂ¢É‰æµÁäØ
  if(!war){
   if(this.ideology==="red"&&this.pos.x>width*border) startWar("border violation");
   if(this.ideology==="blue"&&this.pos.x<width*border) startWar("border violation");
  }

  this.edges();
 }

 edges(){
  if(!war){
   if(this.ideology==="red")
    this.pos.x=constrain(this.pos.x,0,width*border-2);
   else
    this.pos.x=constrain(this.pos.x,width*border+2,width);
  }else{
   this.pos.x=constrain(this.pos.x,0,width);
  }
  this.pos.y=constrain(this.pos.y,0,height);
 }

 dead(){return this.health<=0}

 show(){
  colorMode(HSB,360,100,100);
  fill(this.ideology==="red"?0:220,90,90);
  ellipse(this.pos.x,this.pos.y,this.size);
  colorMode(RGB,255);
 }
}

function updateOrganisms(){
 for(let i=organisms.length-1;i>=0;i--){
  let o=organisms[i];
  o.update();
  o.show();
  if(o.dead()) organisms.splice(i,1);
 }
}

function startWar(reason){
 if(war||civilization<2) return;
 war=true;
 log("‚öî WAR STARTED ("+reason+")");
}

function checkSurrender(){
 let r=organisms.filter(o=>o.ideology==="red").length;
 let b=organisms.filter(o=>o.ideology==="blue").length;
 if(r<5||b<5){
  let winner=r>b?"red":"blue";
  endWar(winner);
 }
}

function endWar(winner){
 war=false;
 let gain=0.08;
 if(winner==="red") border=min(0.8,border+gain);
 else border=max(0.2,border-gain);
 log("üè≥ "+winner+" wins ‚Äì territory expanded");
}

function runCommand(c){
 c=c.trim();
 if(c==="genesis"&&organisms.length===0){
  for(let i=0;i<20;i++) organisms.push(new Organism());
  log("üå± genesis");
 }
 if(c==="war") startWar("command");
 if(c==="reset"){
  organisms=[];foods=[];border=0.5;war=false;civilization=0;
  spawnFood(260);
  runCommand("genesis");
  log("‚Ü∫ reset");
 }
}

function spawnFood(n){
 for(let i=0;i<n;i++)
  foods.push({pos:createVector(random(width),random(height))});
}
function drawFood(){
 fill(100,255,100,150);noStroke();
 for(let f of foods) circle(f.pos.x,f.pos.y,4);
}
function log(t){
 logBuffer.push(t);
 if(logBuffer.length>40) logBuffer.shift();
}
function windowResized(){resizeCanvas(windowWidth,windowHeight);}
</script>
</body>
</html>



