<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>NovaNotions ‚Äì Ideology Biotope Stable</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
<style>
body{margin:0;background:#000;font-family:monospace;overflow:hidden}
#ui{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);
width:90%;text-align:center;z-index:10}
input{width:60%;padding:10px;background:rgba(0,0,0,.8);
border:1px solid #0f0;color:#0f0}
#stats{color:#aaa;font-size:12px;margin-bottom:4px}
#log{position:absolute;top:10px;left:10px;width:420px;height:260px;
overflow:auto;font-size:11px;color:#0f0;
background:rgba(0,0,0,.6);border:1px solid #033;padding:5px}
</style>
</head>

<body>
<div id="log"></div>
<div id="ui">
<div id="stats">
TIME:<span id="timer">00:00</span> |
YEAR:<span id="year">0</span> |
POP:<span id="pop">0</span> |
CIV:<span id="civ">Hunter-Gatherer</span> |
WAR:<span id="warstat">NO</span>
</div>
<input id="cmd" placeholder="> genesis / war / reset">
</div>

<script>
/* =====================
   „Ç∞„É≠„Éº„Éê„É´
===================== */
let organisms=[],foods=[];
let time=0,epoch=0,war=false,civilization=0;
let startTime=0;
const CIV_NAMES=["Hunter-Gatherer","Agriculture","Nation"];
let cmd,logDiv,logBuffer=[];

const BORDER_RATIO=0.5; // ÂõΩÂ¢É‰ΩçÁΩÆ

/* =====================
   ÂàùÊúüÂåñ
===================== */
function setup(){
 createCanvas(windowWidth,windowHeight);
 cmd=document.getElementById("cmd");
 logDiv=document.getElementById("log");
 spawnFood(200);
 startTime=millis();
 runCommand("genesis");

 cmd.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
   runCommand(cmd.value);
   cmd.value="";
  }
 });
}

/* =====================
   „É°„Ç§„É≥„É´„Éº„Éó
===================== */
function draw(){
 background(0);

 drawNations();   // ‚Üê ÂõΩÂÆ∂Â¢ÉÁïåÊèèÁîª

 time++; if(time%60===0) epoch++;
 if(organisms.length>40&&civilization===0) civilization=1;
 if(organisms.length>120&&civilization===1) civilization=2;

 updateUI();

 drawFood();
 updateOrganisms();

 if(!war&&civilization===2&&organisms.length>100) startWar();
 if(frameCount%20===0)
  logDiv.innerHTML=logBuffer.slice().reverse().join("<br>");
}

/* =====================
   ÂõΩÂÆ∂Â¢ÉÁïå ÂèØË¶ñÂåñ
===================== */
function drawNations(){
 noStroke();

 // Â∑¶ÔºöÂÖ±Áî£‰∏ªÁæ©
 fill(120,0,0,40);
 rect(0,0,width*BORDER_RATIO,height);

 // Âè≥ÔºöË≥áÊú¨‰∏ªÁæ©
 fill(0,0,120,40);
 rect(width*BORDER_RATIO,0,width,height);

 // ÂõΩÂ¢ÉÁ∑ö
 stroke(200);
 strokeWeight(civilization===2?3:1);
 line(width*BORDER_RATIO,0,width*BORDER_RATIO,height);

 // „É©„Éô„É´
 noStroke();
 textAlign(CENTER);
 textSize(14);
 fill(255,120,120);
 text("COMMUNISM",width*0.25,30);
 fill(120,120,255);
 text("CAPITALISM",width*0.75,30);
}

/* =====================
   UI
===================== */
function updateUI(){
 let elapsed=millis()-startTime;
 timer.innerText=
  nf(floor(elapsed/60000),2)+":"+nf(floor(elapsed/1000)%60,2);
 year.innerText=epoch;
 pop.innerText=organisms.length;
 civ.innerText=CIV_NAMES[civilization];
 warstat.innerText=war?"YES":"NO";
}

/* =====================
   È£üÊñô
===================== */
function drawFood(){
 noStroke();
 fill(100,255,100,150);
 for(let f of foods){
  circle(f.pos.x,f.pos.y,4);
 }
}

/* =====================
   ÁîüÁâ©
===================== */
class Organism{
 constructor(){
  this.ideology=random()<0.5?"red":"blue";
  this.pos=createVector(
   this.ideology==="red"
    ?random(width*0.05,width*0.45)
    :random(width*0.55,width*0.95),
   random(height)
  );
  this.vel=p5.Vector.random2D().mult(0.6);
  this.size=random(8,14);
  this.health=1;
  this.age=0;
  this.maxAge=random(4000,8000);
  this.baseHue=this.ideology==="red"?0:220;
 }

 update(){
  this.age++;
  this.health-=0.0004;
  this.forage();
  if(war) this.vel.add(p5.Vector.random2D().mult(0.05));
  this.pos.add(this.vel);
  this.edges();
 }

 forage(){
  for(let i=foods.length-1;i>=0;i--){
   if(dist(this.pos.x,this.pos.y,
           foods[i].pos.x,foods[i].pos.y)<this.size){
    this.health+=0.3;
    foods.splice(i,1);
    break;
   }
  }
 }

 edges(){
  if(this.ideology==="red")
   this.pos.x=constrain(this.pos.x,0,width*BORDER_RATIO-2);
  else
   this.pos.x=constrain(this.pos.x,width*BORDER_RATIO+2,width);
  this.pos.y=constrain(this.pos.y,0,height);
 }

 dead(){return this.health<=0||this.age>this.maxAge}

 show(){
  colorMode(HSB,360,100,100);
  fill(this.baseHue,90,90);
  ellipse(this.pos.x,this.pos.y,this.size);
  colorMode(RGB,255);
 }
}

/* =====================
   ÁîüÁâ©Êõ¥Êñ∞
===================== */
function updateOrganisms(){
 for(let i=organisms.length-1;i>=0;i--){
  let o=organisms[i];
  o.update();
  o.show();
  if(o.dead()){
   organisms.splice(i,1);
  }
 }
}

/* =====================
   ÂõΩÂÆ∂„ÉªÊà¶‰∫â
===================== */
function startWar(){
 war=true;
 log("‚öî WAR STARTED");
}

/* =====================
   „Ç≥„Éû„É≥„Éâ
===================== */
function runCommand(c){
 c=c.trim();
 if(c==="genesis"){
  if(organisms.length===0){
   for(let i=0;i<20;i++) organisms.push(new Organism());
   log("üå± genesis");
  }
 }
 if(c==="war") startWar();
 if(c==="reset"){
  organisms=[];foods=[];
  civilization=0;war=false;
  spawnFood(200);
  runCommand("genesis");
  log("‚Ü∫ reset");
 }
}

/* =====================
   Ë£úÂä©
===================== */
function spawnFood(n){
 for(let i=0;i<n;i++)
  foods.push({pos:createVector(random(width),random(height))});
}
function log(t){
 logBuffer.push(t);
 if(logBuffer.length>40) logBuffer.shift();
}
function windowResized(){
 resizeCanvas(windowWidth,windowHeight);
}
</script>
</body>
</html>

